<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnityScan AI - Statathon 2025 Demo</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- QRCode.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    
    <!-- React and Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Custom styles for vibrant UI */
        .hero-bg {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1);
            animation: gradientShift 10s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .ussd-screen {
            background: linear-gradient(135deg, #ff9f43, #ee5253);
            font-family: 'Courier New', monospace;
        }
        .qr-container {
            background: linear-gradient(135deg, #6ab04c, #badc58);
        }
        .language-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .glow-button {
            transition: all 0.3s ease;
        }
        .glow-button:hover {
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /*
         * HOW TO USE THIS DEMO:
         * 1. Login: Use 'user/pass' for user survey access or 'admin/pass' for admin dashboard.
         * 2. User Features:
         *    - USSD Survey: Enter a survey ID and navigate text-based survey for feature phones.
         *    - QR Code: Enter a survey ID on the home screen to generate a QR code instantly.
         *    - Location: Auto-detects location for language (English, Hindi, Tamil, Malayalam, Telugu).
         *    - Survey: Complete sample questions; responses saved in localStorage.
         * 3. Admin Features:
         *    - Create/edit surveys with questions and language settings.
         *    - Generate QR codes and preview USSD flows.
         * 4. Test on mobile for responsiveness.
         */

        // Mock credentials
        const CREDENTIALS = {
            user: { username: 'user', password: 'pass', role: 'user' },
            admin: { username: 'admin', password: 'pass', role: 'admin' }
        };

        // Language Configuration with Regions
        const LANGUAGES = {
            en: {
                name: 'English',
                code: 'en',
                region: 'Urban India',
                welcome: 'Welcome to UnityScan AI',
                ussdTitle: 'USSD Survey',
                qrTitle: 'QR Code Survey',
                question1: 'Do you use digital payments?',
                question2: 'What is your monthly income?',
                options: ['Yes', 'No'],
                incomeOptions: ['Below ₹10,000', '₹10,000-25,000', 'Above ₹25,000'],
                submit: 'Submit',
                back: 'Back',
                next: 'Next',
                login: 'Login',
                username: 'Username',
                password: 'Password',
                loginError: 'Invalid username or password',
                qrPrompt: 'Enter a valid Survey ID (numbers only).',
                qrSuccess: 'QR Code Generated!',
                locationPrompt: 'Allow location access for language selection.'
            },
            hi: {
                name: 'हिंदी',
                code: 'hi',
                region: 'North India',
                welcome: 'UnityScan AI में आपका स्वागत है',
                ussdTitle: 'USSD सर्वे',
                qrTitle: 'QR कोड सर्वे',
                question1: 'क्या आप डिजिटल भुगतान का उपयोग करते हैं?',
                question2: 'आपकी मासिक आय क्या है?',
                options: ['हाँ', 'नहीं'],
                incomeOptions: ['10,000 से कम', '10,000-25,000', '25,000 से अधिक'],
                submit: 'जमा करें',
                back: 'वापस',
                next: 'आगे',
                login: 'लॉगिन',
                username: 'उपयोगकर्ता नाम',
                password: 'पासवर्ड',
                loginError: 'अमान्य उपयोगकर्ता नाम या पासवर्ड',
                qrPrompt: 'वैध सर्वे आईडी (संख्या) दर्ज करें।',
                qrSuccess: 'QR कोड उत्पन्न!',
                locationPrompt: 'भाषा चयन के लिए स्थान अनुमति दें।'
            },
            ta: {
                name: 'தமிழ்',
                code: 'ta',
                region: 'Tamil Nadu',
                welcome: 'UnityScan AI க்கு வரவேற்கிறோம்',
                ussdTitle: 'USSD கணக்கெடுப்பு',
                qrTitle: 'QR குறியீடு கணக்கெடுப்பு',
                question1: 'நீங்கள் டிஜிட்டல் கட்டணத்தைப் பயன்படுத்துகிறீர்களா?',
                question2: 'உங்கள் மாதாந்திர வருமானம் என்ன?',
                options: ['ஆம்', 'இல்லை'],
                incomeOptions: ['10,000க்கு கீழ்', '10,000-25,000', '25,000க்கு மேல்'],
                submit: 'சமர்ப்பிக்கவும்',
                back: 'திரும்ப',
                next: 'அடுத்து',
                login: 'உள்நுழை',
                username: 'பயனர் பெயர்',
                password: 'கடவுச்சொல்',
                loginError: 'தவறான பயனர் பெயர் அல்லது கடவுச்சொல்',
                qrPrompt: 'செல்லுபடியாகும் சர்வே ஐடியை (எண்கள்) உள்ளிடவும்.',
                qrSuccess: 'QR குறியீடு உருவாக்கப்பட்டது!',
                locationPrompt: 'மொழி தேர்ந்தெடுப்பிற்கு அமைவிட அனுமதியை வழங்கவும்.'
            },
            ml: {
                name: 'മലയാളം',
                code: 'ml',
                region: 'Kerala',
                welcome: 'UnityScan AI-ലേക്ക് സ്വാഗതം',
                ussdTitle: 'USSD സർവേ',
                qrTitle: 'QR കോഡ് സർവേ',
                question1: 'നിന്നോട് ഡിജിറ്റൽ പേയ്‌മെന്റുകൾ ഉപയോഗിക്കുന്നുണ്ടോ?',
                question2: 'നിന്റെ മാസവരുമാനം എന്താണ്?',
                options: ['അതെ', 'ഇല്ല'],
                incomeOptions: ['₹10,000-ന് താഴെ', '₹10,000-25,000', '₹25,000-ന് മുകളിൽ'],
                submit: 'സമർപ്പിക്കുക',
                back: 'തിരികെ',
                next: 'അടുത്തത്',
                login: 'ലോഗിൻ',
                username: 'ഉപയോക്തൃനാമം',
                password: 'പാസ്‌വേഡ്',
                loginError: 'അസാധുവായ ഉപയോക്തൃനാമം അല്ലെങ്കിൽ പാസ്‌വേഡ്',
                qrPrompt: 'സർവേ ID (സംഖ്യകൾ മാത്രം) നൽകുക.',
                qrSuccess: 'QR കോഡ് ജനറേറ്റ് ചെയ്തു!',
                locationPrompt: 'ഭാഷ തിരഞ്ഞെടുക്കാൻ സ്ഥലം അനുമതി നൽകുക.'
            },
            te: {
                name: 'తెలుగు',
                code: 'te',
                region: 'Andhra Pradesh/Telangana',
                welcome: 'UnityScan AIకి స్వాగతం',
                ussdTitle: 'USSD సర్వే',
                qrTitle: 'QR కోడ్ సర్వే',
                question1: 'మీరు డిజిటల్ చెల్లింపులను ఉపయోగిస్తున్నారా?',
                question2: 'మీ నెలవారీ ఆదాయం ఎంత?',
                options: ['అవును', 'కాదు'],
                incomeOptions: ['₹10,000 కంటే తక్కువ', '₹10,000-25,000', '₹25,000 కంటే ఎక్కువ'],
                submit: 'సమర్పించు',
                back: 'వెనక్కి',
                next: 'తదుపరి',
                login: 'లాగిన్',
                username: 'వినియోగదారు పేరు',
                password: 'పాస్‌వర్డ్',
                loginError: 'చెల్లని వినియోగదారు పేరు లేదా పాస్‌వర్డ్',
                qrPrompt: 'సర్వే IDని (సంఖ్యలు మాత్రం) నమోదు చేయండి.',
                qrSuccess: 'QR కోడ్ రూపొందించబడింది!',
                locationPrompt: 'భాషను ఎంచుకోడానికి స్థాన అనుమతిని అనుమతించండి.'
            }
        };

        // Main Application Component
        const UnityScanApp = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userRole, setUserRole] = useState(null);
            const [currentLanguage, setCurrentLanguage] = useState('en'); // Default to English
            const [locationDetected, setLocationDetected] = useState(false);
            const [currentLocation, setCurrentLocation] = useState(null);
            const [currentScreen, setCurrentScreen] = useState('login');
            const [ussdStep, setUssdStep] = useState(0);
            const [surveyData, setSurveyData] = useState({});
            const [loginError, setLoginError] = useState('');
            const [surveyId, setSurveyId] = useState('');
            const [qrGenerated, setQrGenerated] = useState(false);
            const [qrMessage, setQrMessage] = useState('');

            // Check login status
            useEffect(() => {
                const role = localStorage.getItem('userRole');
                if (role) {
                    setIsLoggedIn(true);
                    setUserRole(role);
                    setCurrentScreen(role === 'user' ? 'home' : 'admin');
                }
            }, []);

            // Enhanced Location Tracking
            useEffect(() => {
                if (!isLoggedIn || userRole !== 'user') return;
                const cachedLang = localStorage.getItem('userLanguage');
                if (cachedLang) {
                    setCurrentLanguage(cachedLang);
                    setLocationDetected(true);
                    return;
                }
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            setCurrentLocation({ lat: latitude, lng: longitude });
                            const detectedLang = getLanguageByLocation(latitude, longitude);
                            setCurrentLanguage(detectedLang);
                            setLocationDetected(true);
                            localStorage.setItem('userLanguage', detectedLang);
                        },
                        (error) => {
                            console.error('Location access denied:', error);
                            setQrMessage(lang.locationPrompt);
                            setLocationDetected(false);
                            setCurrentLanguage('en'); // Fallback to English
                        },
                        { enableHighAccuracy: true, maximumAge: 10000, timeout: 5000 }
                    );
                } else {
                    setQrMessage(lang.locationPrompt);
                    setLocationDetected(false);
                    setCurrentLanguage('en');
                }
            }, [isLoggedIn, userRole]);

            // Simulate language detection
            const getLanguageByLocation = (lat, lng) => {
                if (lat >= 8.0 && lat <= 13.5 && lng >= 76.0 && lng <= 80.5) return 'ta'; // Tamil Nadu
                if (lat >= 9.0 && lat <= 11.5 && lng >= 75.0 && lng <= 77.0) return 'ml'; // Kerala
                if (lat >= 15.0 && lat <= 18.5 && lng >= 78.0 && lng <= 81.0) return 'te'; // Andhra Pradesh/Telangana
                if (lat >= 19.0 && lat <= 23.0 && lng >= 72.0 && lng <= 75.0) return 'en'; // Urban India (e.g., Mumbai)
                return 'hi'; // Default Hindi
            };

            const lang = LANGUAGES[currentLanguage];

            // Login Component
            const LoginScreen = () => {
                const [username, setUsername] = useState('');
                const [password, setPassword] = useState('');

                const handleLogin = (e) => {
                    e.preventDefault();
                    const user = Object.values(CREDENTIALS).find(
                        u => u.username === username && u.password === password
                    );
                    if (user) {
                        setIsLoggedIn(true);
                        setUserRole(user.role);
                        localStorage.setItem('userRole', user.role);
                        setCurrentScreen(user.role === 'user' ? 'home' : 'admin');
                        setLoginError('');
                    } else {
                        setLoginError(lang.loginError);
                    }
                };

                return (
                    <div className="min-h-screen hero-bg p-4 flex items-center">
                        <div className="max-w-md mx-auto bg-white rounded-2xl shadow-2xl p-8 transform hover:scale-105 transition duration-300">
                            <h2 className="text-3xl font-bold text-white bg-gradient-to-r from-blue-600 to-purple-600 p-4 rounded-lg mb-6 text-center">UnityScan AI {lang.login}</h2>
                            <form onSubmit={handleLogin} className="space-y-6">
                                <div>
                                    <label className="block text-lg font-semibold text-gray-700 mb-2">{lang.username}</label>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-lg font-semibold text-gray-700 mb-2">{lang.password}</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>
                                {loginError && <p className="text-red-500 text-sm">{loginError}</p>}
                                <button
                                    type="submit"
                                    className="w-full py-4 bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white rounded-xl font-semibold glow-button"
                                >
                                    {lang.login}
                                </button>
                            </form>
                        </div>
                    </div>
                );
            };

            // Admin Dashboard Component
            const AdminDashboard = () => {
                const [surveyTitle, setSurveyTitle] = useState('');
                const [question1, setQuestion1] = useState('');
                const [question2, setQuestion2] = useState('');
                const [surveys, setSurveys] = useState(JSON.parse(localStorage.getItem('surveys') || '[]'));
                const [selectedLanguage, setSelectedLanguage] = useState('en');

                const handleCreateSurvey = (e) => {
                    e.preventDefault();
                    const newSurvey = {
                        id: Date.now(),
                        title: surveyTitle,
                        questions: [
                            { text: question1, type: 'multiple-choice', options: LANGUAGES[selectedLanguage].options },
                            { text: question2, type: 'dropdown', options: LANGUAGES[selectedLanguage].incomeOptions }
                        ],
                        language: selectedLanguage
                    };
                    const updatedSurveys = [...surveys, newSurvey];
                    setSurveys(updatedSurveys);
                    localStorage.setItem('surveys', JSON.stringify(updatedSurveys));
                    setSurveyTitle('');
                    setQuestion1('');
                    setQuestion2('');
                };

                const generateQRCode = (surveyId) => {
                    const canvas = document.getElementById(`qr-${surveyId}`);
                    if (canvas) {
                        QRCode.toCanvas(canvas, `https://unityscan-ai.statathon2025.in/survey/${surveyId}`, {
                            width: 100,
                            margin: 1
                        });
                    }
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-yellow-100 to-orange-100 p-4">
                        <div className="max-w-4xl mx-auto">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6 bg-gradient-to-r from-yellow-500 to-orange-500 p-4 rounded-lg text-center">Admin Dashboard</h2>
                            <button
                                onClick={() => {
                                    setIsLoggedIn(false);
                                    setUserRole(null);
                                    localStorage.removeItem('userRole');
                                    setCurrentScreen('login');
                                }}
                                className="mb-4 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl glow-button"
                            >
                                Logout
                            </button>
                            <div className="bg-white rounded-2xl shadow-2xl p-6 mb-6">
                                <h3 className="text-xl font-semibold mb-4">Create Survey</h3>
                                <form onSubmit={handleCreateSurvey} className="space-y-6">
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-2">Survey Title</label>
                                        <input
                                            type="text"
                                            value={surveyTitle}
                                            onChange={(e) => setSurveyTitle(e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-2">Question 1</label>
                                        <input
                                            type="text"
                                            value={question1}
                                            onChange={(e) => setQuestion1(e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-2">Question 2</label>
                                        <input
                                            type="text"
                                            value={question2}
                                            onChange={(e) => setQuestion2(e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-2">Target Language</label>
                                        <select
                                            value={selectedLanguage}
                                            onChange={(e) => setSelectedLanguage(e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500"
                                        >
                                            {Object.entries(LANGUAGES).map(([code, langObj]) => (
                                                <option key={code} value={code}>{langObj.region} ({langObj.name})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <button
                                        type="submit"
                                        className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-semibold glow-button"
                                    >
                                        Create Survey
                                    </button>
                                </form>
                            </div>
                            <div className="bg-white rounded-2xl shadow-2xl p-6">
                                <h3 className="text-xl font-semibold mb-4">Surveys</h3>
                                {surveys.length === 0 && <p className="text-gray-600">No surveys created.</p>}
                                {surveys.map(survey => (
                                    <div key={survey.id} className="border-b py-4">
                                        <h4 className="font-semibold text-lg">{survey.title}</h4>
                                        <p className="text-gray-600">Language: {LANGUAGES[survey.language].name}</p>
                                        <p className="text-gray-600">USSD Preview: {survey.questions.map((q, i) => `${i + 1}. ${q.text} (${q.options.join('/')})`).join(', ')}</p>
                                        <div className="mt-2">
                                            <canvas id={`qr-${survey.id}`}></canvas>
                                            <button
                                                onClick={() => generateQRCode(survey.id)}
                                                className="mt-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg glow-button"
                                            >
                                                Generate QR
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // USSD Survey Component
            const USSDSurvey = () => {
                const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
                const survey = surveys.find(s => s.id.toString() === surveyId) || {
                    questions: [
                        { text: lang.question1, options: lang.options, key: 'digitalPayment' },
                        { text: lang.question2, options: lang.incomeOptions, key: 'income' }
                    ],
                    language: currentLanguage
                };
                const ussdQuestions = survey.questions;
                const currentQuestion = ussdQuestions[ussdStep];

                const handleUSSDResponse = (optionIndex) => {
                    const newData = { ...surveyData, [currentQuestion.key]: currentQuestion.options[optionIndex] };
                    setSurveyData(newData);
                    if (ussdStep < ussdQuestions.length - 1) {
                        setUssdStep(ussdStep + 1);
                    } else {
                        localStorage.setItem('surveyData', JSON.stringify(newData));
                        setCurrentScreen('complete');
                    }
                };

                return (
                    <div className="ussd-screen min-h-screen p-4 text-white">
                        <div className="max-w-md mx-auto">
                            <div className="bg-black bg-opacity-50 rounded-2xl p-6 mb-6">
                                <h2 className="text-2xl font-bold">{lang.ussdTitle}</h2>
                                <p className="text-sm opacity-75">Feature Phone Interface</p>
                            </div>
                            <div className="bg-black bg-opacity-70 rounded-2xl p-6">
                                <h3 className="text-xl mb-4">Q{ussdStep + 1}: {currentQuestion.text}</h3>
                                <div className="space-y-3">
                                    {currentQuestion.options.map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleUSSDResponse(index)}
                                            className="w-full text-left p-3 bg-yellow-500 hover:bg-yellow-600 rounded-xl border-2 border-yellow-400 glow-button"
                                        >
                                            {index + 1}. {option}
                                        </button>
                                    ))}
                                </div>
                                <div className="mt-6 flex justify-between">
                                    <button
                                        onClick={() => ussdStep > 0 ? setUssdStep(ussdStep - 1) : setCurrentScreen('home')}
                                        className="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-xl glow-button"
                                    >
                                        {lang.back}
                                    </button>
                                    <span className="text-sm opacity-75">{ussdStep + 1}/{ussdQuestions.length}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Survey Form Component
            const SurveyForm = () => {
                const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
                const survey = surveys.find(s => s.id.toString() === surveyId) || {
                    questions: [
                        { text: lang.question1, type: 'multiple-choice', options: lang.options, key: 'digitalPayment' },
                        { text: lang.question2, type: 'dropdown', options: lang.incomeOptions, key: 'income' }
                    ],
                    language: currentLanguage
                };
                const [answers, setAnswers] = useState({});

                const handleSubmit = (e) => {
                    e.preventDefault();
                    const finalData = { ...surveyData, ...answers, surveyId };
                    setSurveyData(finalData);
                    localStorage.setItem('surveyData', JSON.stringify(finalData));
                    setCurrentScreen('complete');
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-100 to-purple-100 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-6">
                                <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center bg-gradient-to-r from-indigo-500 to-purple-500 p-4 rounded-xl">{lang.welcome}</h2>
                                <form onSubmit={handleSubmit} className="space-y-6">
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-2">
                                            1. {survey.questions[0].text}
                                        </label>
                                        <div className="space-y-2">
                                            {survey.questions[0].options.map((option, index) => (
                                                <label key={index} className="flex items-center">
                                                    <input
                                                        type="radio"
                                                        name="digitalPayment"
                                                        value={option}
                                                        onChange={(e) => setAnswers({ ...answers, digitalPayment: e.target.value })}
                                                        className="mr-3 text-purple-600 focus:ring-purple-500"
                                                        required
                                                    />
                                                    <span className="text-lg">{option}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-2">
                                            2. {survey.questions[1].text}
                                        </label>
                                        <select
                                            name="income"
                                            onChange={(e) => setAnswers({ ...answers, income: e.target.value })}
                                            className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500"
                                            required
                                        >
                                            <option value="">Select income range</option>
                                            {survey.questions[1].options.map((option, index) => (
                                                <option key={index} value={option}>{option}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <button
                                        type="submit"
                                        className="w-full py-4 bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white rounded-xl font-semibold glow-button"
                                    >
                                        {lang.submit}
                                    </button>
                                </form>
                                <button
                                    onClick={() => setCurrentScreen('home')}
                                    className="w-full mt-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl glow-button"
                                >
                                    {lang.back}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Survey Complete Component
            const SurveyComplete = () => {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-100 to-teal-100 p-4 flex items-center">
                        <div className="max-w-md mx-auto text-center">
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="text-6xl mb-4 text-green-500">✅</div>
                                <h2 className="text-3xl font-bold text-green-800 mb-4">Survey Complete!</h2>
                                <p className="text-gray-600 mb-6 text-lg">Thank you for participating.</p>
                                <div className="bg-gray-50 rounded-xl p-4 mb-6 text-left">
                                    <h3 className="font-semibold mb-2 text-lg">Your Responses:</h3>
                                    <div className="text-md space-y-1">
                                        {Object.entries(surveyData).map(([key, value]) => (
                                            <div key={key}>
                                                <span className="font-medium capitalize">{key}:</span> {value}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <button
                                    onClick={() => {
                                        setCurrentScreen('home');
                                        setSurveyData({});
                                        setUssdStep(0);
                                        setQrGenerated(false);
                                        setSurveyId('');
                                        setQrMessage('');
                                    }}
                                    className="w-full py-4 bg-gradient-to-r from-teal-500 to-green-500 hover:from-teal-600 hover:to-green-600 text-white rounded-xl font-semibold glow-button"
                                >
                                    Start New Survey
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Home Screen Component (User)
            const HomeScreen = () => {
                const handleGenerateQR = () => {
                    if (!surveyId || !/^\d+$/.test(surveyId)) {
                        setQrMessage(lang.qrPrompt);
                        setQrGenerated(false);
                        return;
                    }
                    const canvas = document.getElementById('qr-canvas');
                    if (canvas) {
                        canvas.innerHTML = '';
                        QRCode.toCanvas(canvas, `https://unityscan-ai.statathon2025.in/survey/${surveyId}`, {
                            width: 150,
                            margin: 2
                        });
                        setQrGenerated(true);
                        setQrMessage(lang.qrSuccess);
                    }
                };

                return (
                    <div className="min-h-screen hero-bg p-4">
                        <div className="max-w-md mx-auto">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl font-bold text-white bg-gradient-to-r from-yellow-400 to-red-500 p-6 rounded-2xl mb-4">UnityScan AI</h1>
                                <p className="text-white text-lg mb-4">Statathon 2025 Demo</p>
                                <div className={`mt-4 inline-flex items-center px-4 py-2 rounded-full text-lg ${locationDetected ? 'bg-green-200 text-green-800 language-indicator' : 'bg-red-200 text-red-800'}`}>
                                    🌍 {lang.name} ({lang.region})
                                    {locationDetected && currentLocation && <span className="ml-2">📍 Lat: {currentLocation.lat.toFixed(2)}, Lng: {currentLocation.lng.toFixed(2)}</span>}
                                    {!locationDetected && <span className="ml-2">⚠️</span>}
                                </div>
                                <button
                                    onClick={() => {
                                        setIsLoggedIn(false);
                                        setUserRole(null);
                                        localStorage.removeItem('userRole');
                                        setCurrentScreen('login');
                                    }}
                                    className="mt-4 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl glow-button"
                                >
                                    Logout
                                </button>
                            </div>
                            <div className="space-y-6">
                                <div className="bg-white rounded-2xl shadow-2xl p-6 border-l-4 border-blue-500">
                                    <div className="flex items-center mb-4">
                                        <span className="text-3xl mr-4">📱</span>
                                        <h2 className="text-2xl font-semibold text-gray-800">{lang.ussdTitle}</h2>
                                    </div>
                                    <p className="text-gray-600 mb-4 text-lg">Text-based survey for feature phones</p>
                                    <input
                                        type="text"
                                        value={surveyId}
                                        onChange={(e) => setSurveyId(e.target.value)}
                                        placeholder="Enter Survey ID"
                                        className="w-full p-4 border border-gray-300 rounded-xl mb-4 focus:ring-2 focus:ring-blue-500"
                                    />
                                    <button
                                        onClick={() => surveyId && setCurrentScreen('ussd')}
                                        className="w-full py-4 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-xl font-semibold glow-button"
                                        disabled={!surveyId}
                                    >
                                        Start USSD Survey
                                    </button>
                                </div>
                                <div className="bg-white rounded-2xl shadow-2xl p-6 border-l-4 border-green-500">
                                    <div className="flex items-center mb-4">
                                        <span className="text-3xl mr-4">📲</span>
                                        <h2 className="text-2xl font-semibold text-gray-800">{lang.qrTitle}</h2>
                                    </div>
                                    <p className="text-gray-600 mb-4 text-lg">Generate QR code for smartphones</p>
                                    <input
                                        type="text"
                                        value={surveyId}
                                        onChange={(e) => setSurveyId(e.target.value)}
                                        placeholder="Enter Survey ID (e.g., 123)"
                                        className="w-full p-4 border border-gray-300 rounded-xl mb-4 focus:ring-2 focus:ring-green-500"
                                    />
                                    <button
                                        onClick={handleGenerateQR}
                                        className="w-full py-4 bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white rounded-xl font-semibold glow-button"
                                        disabled={!surveyId}
                                    >
                                        Generate QR Code
                                    </button>
                                    {qrMessage && <p className={`text-center mt-2 text-lg ${qrGenerated ? 'text-green-600' : 'text-red-500'}`}>{qrMessage}</p>}
                                    {qrGenerated && (
                                        <div className="flex justify-center mt-4">
                                            <canvas id="qr-canvas" className="border-4 border-gray-300 rounded-2xl"></canvas>
                                        </div>
                                    )}
                                    {qrGenerated && (
                                        <button
                                            onClick={() => setCurrentScreen('survey')}
                                            className="w-full mt-4 py-4 bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white rounded-xl font-semibold glow-button"
                                        >
                                            📱 Simulate QR Scan
                                        </button>
                                    )}
                                </div>
                            </div>
                            <div className="mt-6 bg-white rounded-2xl shadow-2xl p-6">
                                <h3 className="text-lg font-semibold text-gray-700 mb-4">Select Language:</h3>
                                <div className="grid grid-cols-3 gap-3">
                                    {Object.entries(LANGUAGES).map(([code, langObj]) => (
                                        <button
                                            key={code}
                                            onClick={() => {
                                                setCurrentLanguage(code);
                                                localStorage.setItem('userLanguage', code);
                                            }}
                                            className={`p-3 text-lg rounded-xl ${currentLanguage === code ? 'bg-blue-200 text-blue-800 border-2 border-blue-400' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'}`}
                                        >
                                            {langObj.name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Main Render Logic
            return (
                <>
                    {!isLoggedIn && <LoginScreen />}
                    {isLoggedIn && userRole === 'user' && (
                        <>
                            {currentScreen === 'home' && <HomeScreen />}
                            {currentScreen === 'ussd' && <USSDSurvey />}
                            {currentScreen === 'survey' && <SurveyForm />}
                            {currentScreen === 'complete' && <SurveyComplete />}
                        </>
                    )}
                    {isLoggedIn && userRole === 'admin' && <AdminDashboard />}
                </>
            );
        };

        // Render the app
        ReactDOM.render(<UnityScanApp />, document.getElementById('root'));
    </script>
</body>
</html>
